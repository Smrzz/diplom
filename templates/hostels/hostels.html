{% load static %}
<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ö—É–≤–∞365</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}" />
    <script src="{% static 'js/pr.js' %}"></script>
  </head>
  <body>
    <header class="header">
      <div class="header-content">
        <div class="logo">
          <a href="{% url 'home' %}">
            <img src="{% static 'imgs/logo.svg' %}" class="logo" />
          </a>
        </div>
        <ul class="navbar">
          <a href="{% url 'hostels' %}"><li class="nav">–ì–æ—Å—Ç–∏–Ω–∏—Ü–∞</li></a>
          <a href="{% url 'rental' %}"><li class="nav">–ü—Ä–æ–∫–∞—Ç</li></a>
          <a href="{% url 'news' %}"><li class="nav">–ù–æ–≤–æ—Å—Ç–∏</li></a>
          <a href="https://rtsp.me/embed/h3Ykkn7E/"><li class="nav">–í–µ–±-–∫–∞–º–µ—Ä–∞</li></a>
        </ul>
      </div>
    </header>

    <main class="gast-container">
      <section class="gast-main">
        <div class="gast-blocks">
          <!-- –û–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π -->
          <div class="gast-block">
            <img src="{% static 'imgs/1mest 1.png' %}" class="gast-pic" />
            <div class="text-gast">
              <h3 class="title-gast">–û–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π –Ω–æ–º–µ—Ä</h3>
              <h2 class="subtitle-gast">–í –±—É–¥–Ω–∏–µ –¥–Ω–∏ 2000—Ä/—Å—É—Ç–∫–∏ <br />–í –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ 3000—Ä/—Å—É—Ç–∫–∏</h2>
              <button class="btn-gast" onclick="openForm('–û–¥–Ω–æ–º–µ—Å—Ç–Ω—ã–π')">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
          </div>

          <!-- –î–≤—É—Ö–º–µ—Å—Ç–Ω—ã–π -->
          <div class="gast-block">
            <img src="{% static 'imgs/2mest.jpg' %}" class="gast-pic" />
            <div class="text-gast">
              <h3 class="title-gast">–î–≤—É—Ö–º–µ—Å—Ç–Ω—ã–π –Ω–æ–º–µ—Ä</h3>
              <h2 class="subtitle-gast">–í –±—É–¥–Ω–∏–µ –¥–Ω–∏ 3000—Ä/—Å—É—Ç–∫–∏ <br />–í –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ 4000—Ä/—Å—É—Ç–∫–∏</h2>
              <button class="btn-gast" onclick="openForm('–î–≤—É—Ö–º–µ—Å—Ç–Ω—ã–π')">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
          </div>

          <!-- –ß–µ—Ç—ã—Ä—ë—Ö–º–µ—Å—Ç–Ω—ã–π -->
          <div class="gast-block">
            <img src="{% static 'imgs/3mest.jpg' %}" class="gast-pic" />
            <div class="text-gast">
              <h3 class="title-gast">–ß–µ—Ç—ã—Ä—ë—Ö–º–µ—Å—Ç–Ω—ã–π –Ω–æ–º–µ—Ä</h3>
              <h2 class="subtitle-gast">–í –±—É–¥–Ω–∏–µ –¥–Ω–∏ 5000—Ä/—Å—É—Ç–∫–∏ <br />–í –ø—Ä–∞–∑–¥–Ω–∏—á–Ω—ã–µ –¥–Ω–∏ 7000—Ä/—Å—É—Ç–∫–∏</h2>
              <button class="btn-gast" onclick="openForm('–ß–µ—Ç—ã—Ä—ë—Ö–º–µ—Å—Ç–Ω—ã–π')">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <div class="logo">
          <a href="{% url 'home' %}">
            <img src="{% static 'imgs/logo.svg' %}" class="logo" />
          </a>
        </div>
        <div class="social">
          <a href="https://vk.com/kuva365"><img src="{% static 'imgs/vk.svg' %}" class="footer-icons" /></a>
          <a href="https://t.me/s/kuva365"><img src="{% static 'imgs/tg.svg' %}" class="footer-icons" /></a>
        </div>
        <h4 class="footer-num">8 (800) 55 35 35</h4>
      </div>
    </footer>

    <!-- üßæ –ú–û–î–ê–õ–¨–ù–û–ï –û–ö–ù–û -->
  <div class="form-popup" id="bookingPopup">
    <form method="post" action="{% url 'book_room' %}" class="form-container">
      <button type="button" class="close-btn" onclick="closeForm()" aria-label="–ó–∞–∫—Ä—ã—Ç—å">‚úñ</button>
      <h2>–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–æ–º–µ—Ä–∞</h2>
      {% csrf_token %}
      <input type="hidden" name="room_type" id="popupRoomType" />

      <div class="form-group">
        <label for="name"><b>–ò–º—è</b></label>
        <input type="name" name="name" id="name" placeholder="–í–∞—à–µ –∏–º—è" required/>
        <div class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è</div>
      </div>
      
      <div class="form-group">
        <label for="phone"><b>–¢–µ–ª–µ—Ñ–æ–Ω</b></label>
        <input type="tel" name="phone" id="phone" placeholder="+7 (___) ___-__-__" required pattern="\+7\s?[\(]{0,1}[0-9]{3}[\)]{0,1}\s?\d{3}[-]{0,1}\d{2}[-]{0,1}\d{2}" />
        <div class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞</div>
      </div>
      
      <div class="form-group">
        <label for="popupCheckIn"><b>–î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞</b></label>
        <input type="date" name="check_in" id="popupCheckIn" required min="{{ today|date:'Y-m-d' }}" />
        <div class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –∑–∞–µ–∑–¥–∞</div>
      </div>
      
      <div class="form-group">
        <label for="popupCheckOut"><b>–î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞</b></label>
        <input type="date" name="check_out" id="popupCheckOut" required />
        <div class="error-message">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –¥–∞—Ç—É –≤—ã–µ–∑–¥–∞</div>
      </div>
      
      <button type="submit" class="btn">–ó–∞–±—Ä–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä</button>
    </form>
  </div>

    <!-- üìú JS -->
    <script>
      const unavailableDates = {{ unavailable_json|safe }};
      const today = "{{ today|date:'Y-m-d' }}";

      function blockDates(roomType, checkInInput, checkOutInput) {
        const disabledDates = new Set(unavailableDates[roomType] || []);

        function disable(input) {
          const copy = input.cloneNode();
          input.parentNode.replaceChild(copy, input);
          copy.addEventListener("input", () => {
            if (disabledDates.has(copy.value)) {
              alert("–≠—Ç–∞ –¥–∞—Ç–∞ —É–∂–µ –∑–∞–Ω—è—Ç–∞");
              copy.value = "";
            }
          });
        }

        disable(checkInInput);
        disable(checkOutInput);
      }

      function openForm(roomType) {
        const popup = document.getElementById("bookingPopup");
        popup.classList.add("active");
        document.getElementById("popupRoomType").value = roomType;

        const checkIn = document.getElementById("popupCheckIn");
        const checkOut = document.getElementById("popupCheckOut");
        blockDates(roomType, checkIn, checkOut);
      }

      function closeForm() {
        document.getElementById("bookingPopup").classList.remove("active");
      }

      window.addEventListener("click", function (e) {
        const popup = document.getElementById("bookingPopup");
        if (e.target === popup) {
          closeForm();
        }
      });
      // –ú–∞—Å–∫–∞ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
      document.getElementById('phone').addEventListener('input', function(e) {
          let value = e.target.value.replace(/\D/g, '');

          // –ï—Å–ª–∏ –Ω–æ–º–µ—Ä –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å 8 –∏–ª–∏ 7, —É–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—É—é —Ü–∏—Ñ—Ä—É (–æ—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ 10 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã)
          if (value.startsWith('8')) value = value.slice(1);
          if (value.startsWith('7')) value = value.slice(1);

          value = value.slice(0, 10); // –º–∞–∫—Å–∏–º—É–º 10 —Ü–∏—Ñ—Ä –ø–æ—Å–ª–µ –∫–æ–¥–∞ —Å—Ç—Ä–∞–Ω—ã

          let masked = '+7 ';
          if (value.length > 0) masked += '(' + value.substring(0, 3);
          if (value.length >= 4) masked += ') ' + value.substring(3, 6);
          else if (value.length > 3) masked += ') ';
          if (value.length >= 7) masked += '-' + value.substring(6, 8);
          else if (value.length > 6) masked += '-' + value.substring(6, 8);
          if (value.length >= 9) masked += '-' + value.substring(8, 10);

          e.target.value = masked.trim();
      });


    </script>
    
  </body>
</html>
